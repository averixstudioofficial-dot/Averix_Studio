<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Averix Studio ‚Äì Contact Premium</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        :root {
            --gold: #ffcc00;
            --bg-black: #020202;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
        body { background: var(--bg-black); color: #fff; overflow-x: hidden; }
        
        .video-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; overflow: hidden; }
        .video-bg video { width: 100%; height: 100%; object-fit: cover; opacity: 0.3; }
        
        .back-btn { position: fixed; top: 20px; left: 25px; background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 30px; border: 1px solid var(--gold); color: var(--gold); text-decoration: none; z-index: 1000; font-weight: 600; }
        
        .banner { width: 100%; height: 30vh; display: flex; justify-content: center; align-items: center; }
        .banner h1 { font-size: clamp(30px, 8vw, 50px); color: var(--gold); text-transform: uppercase; letter-spacing: 3px; }

        .container { max-width: 900px; margin: auto; padding: 20px; }
        .contact-card { background: var(--glass); padding: 40px; border-radius: 30px; border: 1px solid var(--glass-border); backdrop-filter: blur(15px); }
        
        .contact-form textarea { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); padding: 20px; border-radius: 15px; color: #fff; font-size: 16px; outline: none; margin-bottom: 20px; resize: none; }
        .submit-btn { width: 100%; padding: 18px; background: var(--gold); color: #000; font-weight: 700; border: none; border-radius: 15px; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .submit-btn:hover { background: #fff; transform: scale(1.02); }
    </style>
</head>
<body>

<div class="video-bg"><video autoplay muted loop playsinline><source src="static/bg.mp4" type="video/mp4"></video></div>
<a href="index.html" class="back-btn">‚Üê Home</a>

<div class="banner"><h1>Contact Support</h1></div>

<div class="container">
    <div class="contact-card" data-aos="zoom-in">
        <div class="contact-form">
            <textarea id="userMessage" rows="6" placeholder="Type your project query here..." required></textarea>
            
            <button id="sendBtn" onclick="handleContactSubmit()" class="submit-btn">Send Message</button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    AOS.init({ duration: 1000 });

    const firebaseConfig = {
        apiKey: "AIzaSyCQ53VH7o3SoWYh1bsWmxJQreJJriYRtHc",
        authDomain: "averixcreativestudio.firebaseapp.com",
        projectId: "averixcreativestudio",
        storageBucket: "averixcreativestudio.firebasestorage.app",
        messagingSenderId: "963089827741",
        appId: "1:963089827741:web:72b01b209a4785e1f51174"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let loggedInUser = null;

    // Monitor Auth state
    auth.onAuthStateChanged(user => {
        loggedInUser = user;
    });

    function handleContactSubmit() {
        // Step 1: Login Check (Strict)
        if (!loggedInUser) {
            alert("üîí Login Required! Please sign in to contact Averix Studio.");
            window.location.href = "index.html";
            return;
        }

        const msgValue = document.getElementById('userMessage').value;
        const btn = document.getElementById('sendBtn');

        // Step 2: Empty Check
        if (msgValue.trim() === "") {
            alert("Please enter your message before sending.");
            return;
        }

        btn.innerText = "Processing Cloud & WhatsApp...";
        btn.disabled = true;

        // Step 3: Save to Cloud (Firestore)
        db.collection("enquiries").add({
            clientEmail: loggedInUser.email,
            clientName: loggedInUser.displayName || "Studio Client",
            message: msgValue,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            // Step 4: Open WhatsApp
            const finalMsg = `Hello Averix Studio! üé¨\n\n*Client:* ${loggedInUser.email}\n*Query:* ${msgValue}`;
            const waLink = `https://wa.me/919360436090?text=${encodeURIComponent(finalMsg)}`;
            window.open(waLink, '_blank');
            
            btn.innerText = "Message Sent!";
            document.getElementById('userMessage').value = "";
            btn.disabled = false;
        }).catch(err => {
            console.error(err);
            alert("Cloud Error! Try again.");
            btn.disabled = false;
        });
    }
</script>
</body>
</html>
